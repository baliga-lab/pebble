<div id="main" class="lift:surround?with=default;at=content">
  <head_merge>
    <title>Pebble - Data Matrix Viewer</title>
    <span class="lift:ContextPathJs.variable?name=pebbleContext"></span>
    <script id="highcharts" src="/js/highcharts.js"></script>
    <script type="text/javascript">
      function getSelectedRows() {
        return $('tr.selected');
      }
      function makeRowList(selectedRows) {
        var rowList = '';
        for (var i = 0; i < selectedRows.length; i++) {
          if (i > 0) rowList += ',';
          rowList += selectedRows.parent().children().index(selectedRows[i]);
        }
        return rowList;
      }
      function highChartsLineChart(id, baseurl) {
        var selectedRows = getSelectedRows();
        var rowList = makeRowList(selectedRows);
        if (selectedRows.length > 0) {
          var paramString = window.location.href.slice(window.location.href.indexOf('?') + 1)
          $.get(pebbleContext + baseurl + '?rows=' + rowList + '&chartId=' + id + '&' + paramString,
          function(data) {
            var chart = new Highcharts.Chart(data);
            $('#' + id).show();
          });
        }
        return false;
      }

      function showLambdas() {
        return highChartsLineChart('chart1', '/highcharts/lambdas');
      }
      function showRatios() {
        return highChartsLineChart('chart2', '/highcharts/ratios');
      }

      $(document).ready(function() {
        $('#chart1').hide();
        $('#chart2').hide();

        $('.data_table tr').click(function() { $(this).toggleClass('selected'); });
        $('#show-lambdas').click(function() { return showLambdas(); });
        $('#show-ratios').click(function() { return showRatios(); });
      });
    </script>
  </head_merge>
  <h2 class="alt">Data Matrix Viewer</h2>
  <a id="show-lambdas" href="#">Plot Lambdas</a>
  <a id="show-ratios" href="#">Plot Ratios</a>
  <div id="chart1" style="width: 640px; height: 300px;"></div>
  <div id="chart2" style="width: 640px; height: 300px;"></div>
  <span class="lift:Dmv.table"></span>
</div>
